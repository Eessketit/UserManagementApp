@page
@model UserManagementApp.Pages.Users.IndexModel
@{
    ViewData["Title"] = "Users";
}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">Users</h2>
    </div>

    <form method="post">

        <!-- ACTION BUTTONS -->
        <div class="btn-toolbar mb-3 gap-2">
            <button asp-page-handler="Block" class="btn btn-warning btn-sm">
                Block
            </button>
            <button asp-page-handler="Unblock" class="btn btn-success btn-sm">
                Unblock
            </button>
            <button asp-page-handler="Delete" class="btn btn-danger btn-sm">
                Delete
            </button>
        </div>

        <!-- USERS TABLE -->
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>
                            <input type="checkbox" onclick="toggleAll(this)" />
                        </th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Registered</th>
                        <th>Last login</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var user in Model.Users)
                {
                    var isCurrent = user.Id == Model.CurrentUserId;

                    <tr class="@(isCurrent ? "table-info" : "")">
                        <td>
                            <input type="checkbox" name="SelectedIds" value="@user.Id" />
                        </td>
                        <td>
                            @user.Email
                            @if (isCurrent)
                            {
                                <span class="badge bg-secondary ms-1">You</span>
                            }
                        </td>
                        <td>
                            @if (user.Status == UserStatus.Blocked)
                            {
                                <span class="badge bg-danger">Blocked</span>
                            }
                            else
                            {
                                <span class="badge bg-success">Active</span>
                            }
                        </td>
                        <td>@user.RegisteredAt.ToString("yyyy-MM-dd")</td>
                        <td>
                            @(user.LastLoginAt?.ToString("yyyy-MM-dd HH:mm") ?? "â€”")
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

    </form>
</div>

@section Scripts {
<script>
    function toggleAll(source) {
        document
            .querySelectorAll('input[name="SelectedIds"]')
            .forEach(cb => cb.checked = source.checked);
    }
</script>
}
